var y=Object.defineProperty;var S=(o,t,e)=>t in o?y(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>(S(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const n of h.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=e(i);fetch(i.href,h)}})();function E(o){const t=document.getElementById("color-picker"),e=document.getElementById("color-picker-label");e.addEventListener("click",function(){t.click()}),t.addEventListener("input",function(){e.style.backgroundImage="none",e.style.backgroundColor=t.value,o.strokeStyle=t.value,o.fillStyle=t.value})}class f{constructor(t,e){this.context=t,this.canvas=e}getMousePos(t){let e=this.canvas.getBoundingClientRect(),s=this.canvas.width/e.width,i=this.canvas.height/e.height;return{x:(t.clientX-e.left)*s,y:(t.clientY-e.top)*i}}}class u extends f{constructor(e,s){super(e,s);a(this,"handleMouseLeave",()=>{this.canvas.removeEventListener("mousemove",this.handleMouseMove)});this.fill=!1}handleMouseDown(e){const{x:s,y:i}=this.getMousePos(e);this.startX=s,this.startY=i,this.savedImageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseleave",this.handleMouseLeave)}handleMouseUp(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp)}}class v{constructor(t,e){this.color=t,this.size=e,this.distanceThreshold=15+this.size/2}isSelected(t,e){throw new Error("Abstract method isSelected has not been implemented.")}moveShape(t,e){throw new Error("Abstract method moveShape has not been implemented.")}drawShape(t){t.strokeStyle=this.color,t.fillStyle=this.color,t.lineWidth=this.size,t.beginPath()}}class L extends v{constructor(t,e,s){super(t,e),this.path=s}isSelected(t,e){for(const s of this.path)if(Math.abs(t-s.x)<=this.distanceThreshold&&Math.abs(e-s.y)<=this.distanceThreshold)return!0;return!1}moveShape(t,e){for(const s of this.path)s.x+=t,s.y+=e}drawShape(t){super.drawShape(t),t.moveTo(this.path[0].x,this.path[0].y);for(const e of this.path)t.lineTo(e.x,e.y);t.stroke(),t.closePath()}}const c=class{static addShape(t){c.undoneHistory=[],c.history.push(t)}static deleteShape(t){const e=c.history.indexOf(t);c.history.splice(e,1),c.history.push({type:"delete",shape:t,index:e}),c.undoneHistory=[]}static getShapes(){return c.history.filter(t=>t.type!=="delete")}static clearHistory(){c.history=[],c.undoneHistory=[]}static undoLastShape(){const t=c.history.pop();t!==void 0&&(t.type==="delete"&&c.history.splice(t.index,0,t.shape),c.undoneHistory.push(t))}static redoLastShape(){const t=c.undoneHistory.pop();t!==void 0&&(t.type==="delete"&&c.history.splice(t.index,1),c.history.push(t))}static clearCanvas(t,e){t.clearRect(0,0,e.width,e.height)}static redrawCanvas(t,e){const s=t.strokeStyle,i=t.lineWidth;this.clearCanvas(t,e);const h=c.getShapes();for(const n of h)n.drawShape(t);t.strokeStyle=s,t.fillStyle=s,t.lineWidth=i}};let r=c;a(r,"history",[]),a(r,"undoneHistory",[]);class C extends u{constructor(){super(...arguments);a(this,"handleMouseDown",e=>{super.handleMouseDown(e),this.drawing=!0,this.path=[],this.context.beginPath(),this.handleMouseMove(e)});a(this,"handleMouseMove",e=>{if(!this.drawing)return;let{x:s,y:i}=this.getMousePos(e);this.context.lineTo(s,i),this.context.stroke(),this.path.push({x:s,y:i})});a(this,"handleMouseUp",()=>{if(!this.drawing)return;this.drawing=!1,super.handleMouseUp();const e=new L(this.context.strokeStyle,this.context.lineWidth,this.path);r.addShape(e)})}}class D extends v{constructor(t,e,s,i,h,n){super(t,e),this.startX=s,this.startY=i,this.endX=h,this.endY=n}isSelected(t,e){const s=this.startX,i=this.startY,h=this.endX,n=this.endY,l=(h-s)**2+(n-i)**2,m=Math.max(0,Math.min(1,((t-s)*(h-s)+(e-i)*(n-i))/l)),w=s+m*(h-s),g=i+m*(n-i);return Math.sqrt((t-w)**2+(e-g)**2)<=this.distanceThreshold}moveShape(t,e){this.startX+=t,this.startY+=e,this.endX+=t,this.endY+=e}drawShape(t){super.drawShape(t),t.moveTo(this.startX,this.startY),t.lineTo(this.endX,this.endY),t.strokeStyle=this.color,t.lineWidth=this.size,t.stroke()}}class X extends u{constructor(){super(...arguments);a(this,"handleMouseMove",e=>{this.context.putImageData(this.savedImageData,0,0);const{x:s,y:i}=this.getMousePos(e);this.endX=s,this.endY=i,this.context.beginPath(),this.context.moveTo(this.startX,this.startY),this.context.lineTo(this.endX,this.endY),this.context.stroke()});a(this,"handleMouseUp",()=>{super.handleMouseUp();const e=new D(this.context.strokeStyle,this.context.lineWidth,this.startX,this.startY,this.endX,this.endY);r.addShape(e)})}}class Y extends v{constructor(t,e,s,i,h,n,l){super(t,e),this.startX=s,this.startY=i,this.width=h,this.height=n,this.fill=l}isSelected(t,e){return t+this.distanceThreshold>=this.startX&&t<=this.startX+this.width+this.distanceThreshold&&e+this.distanceThreshold>=this.startY&&e<=this.startY+this.height+this.distanceThreshold}moveShape(t,e){this.startX+=t,this.startY+=e}drawShape(t){super.drawShape(t),t.rect(this.startX,this.startY,this.width,this.height),this.fill?t.fill():t.stroke()}}class b extends u{constructor(){super(...arguments);a(this,"handleMouseMove",e=>{this.context.putImageData(this.savedImageData,0,0);const{x:s,y:i}=this.getMousePos(e);this.endX=s,this.endY=i;const h=this.endX-this.startX,n=this.endY-this.startY;this.context.beginPath(),this.context.rect(this.startX,this.startY,h,n),this.fill?this.context.fill():this.context.stroke()});a(this,"handleMouseUp",()=>{super.handleMouseUp();const e=new Y(this.context.strokeStyle,this.context.lineWidth,this.startX,this.startY,this.endX-this.startX,this.endY-this.startY,this.fill);r.addShape(e)})}}class k extends v{constructor(t,e,s,i,h,n){super(t,e),this.startX=s,this.startY=i,this.radius=h,this.fill=n}isSelected(t,e){return Math.sqrt((this.startX-t)**2+(this.startY-e)**2)<=this.radius+this.distanceThreshold}moveShape(t,e){this.startX+=t,this.startY+=e}drawShape(t){super.drawShape(t),t.arc(this.startX,this.startY,this.radius,0,2*Math.PI),this.fill?t.fill():t.stroke()}}class x extends u{constructor(){super(...arguments);a(this,"handleMouseMove",e=>{this.context.putImageData(this.savedImageData,0,0);const{x:s,y:i}=this.getMousePos(e);this.endX=s,this.endY=i,this.radius=Math.sqrt(Math.pow(this.endX-this.startX,2)+Math.pow(this.endY-this.startY,2)),this.context.beginPath(),this.context.arc(this.startX,this.startY,this.radius,0,2*Math.PI),this.fill?this.context.fill():this.context.stroke()});a(this,"handleMouseUp",e=>{super.handleMouseUp(e);const s=new k(this.context.strokeStyle,this.context.lineWidth,this.startX,this.startY,this.radius,this.fill);r.addShape(s)})}}class M extends f{constructor(e,s){super(e,s);a(this,"handleMouseDown",e=>{this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp);const{x:s,y:i}=this.getMousePos(e),h=r.getShapes();for(let n=h.length-1;n>=0;n--){const l=h[n];if(l.isSelected(s,i)){this.shapeSelected(s,i,l);return}}});a(this,"hoverForCustomCursor",e=>{const{x:s,y:i}=this.getMousePos(e),h=r.getShapes();for(let n=h.length-1;n>=0;n--)if(h[n].isSelected(s,i)){this.customCursorActive||(this.canvas.classList.toggle(this.customCursorName),this.customCursorActive=!0);return}this.customCursorActive&&(this.canvas.classList.toggle(this.customCursorName),this.customCursorActive=!1)});a(this,"stopHoverForCustomCursor",()=>{this.customCursorActive&&(this.canvas.classList.toggle(this.customCursorName),this.customCursorActive=!1)});this.customCursorActive=!1}}class P extends M{constructor(e,s){super(e,s);a(this,"shapeSelected",(e,s,i)=>{this.selectedObject=i,this.initialMouseX=e,this.initialMouseY=s,this.isDragging=!0});a(this,"handleMouseUp",()=>{this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.isDragging=!1});a(this,"handleMouseMove",e=>{if(this.isDragging){const{x:s,y:i}=this.getMousePos(e),h=s-this.initialMouseX,n=i-this.initialMouseY;this.selectedObject.moveShape(h,n),r.redrawCanvas(this.context,this.canvas),this.initialMouseX=s,this.initialMouseY=i}});this.customCursorName="cursor-move"}}class T extends M{constructor(e,s){super(e,s);a(this,"shapeSelected",(e,s,i)=>{this.canvas.classList.toggle(this.customCursorName),this.customCursorActive=!1,r.deleteShape(i),r.redrawCanvas(this.context,this.canvas)});this.customCursorName="cursor-not-allowed"}}class I{constructor(t,e){this.canvas=e,this.context=t,this.activeMouseDownEvent=null,this.activeMouseMoveEvent=null,this.activeMouseLeaveEvent=null,this.pen=new C(t,e),this.path=new X(t,e),this.rect=new b(t,e),this.circle=new x(t,e),this.move=new P(t,e),this.delete=new T(t,e),this.penStartDraw=this.pen.handleMouseDown.bind(this.pen),this.startPath=this.path.handleMouseDown.bind(this.path),this.startRect=this.rect.handleMouseDown.bind(this.rect),this.startCircle=this.circle.handleMouseDown.bind(this.circle),this.startMove=this.move.handleMouseDown.bind(this.move),this.hoverMove=this.move.hoverForCustomCursor.bind(this.move),this.stopHoverMove=this.move.stopHoverForCustomCursor.bind(this.move),this.startDelete=this.delete.handleMouseDown.bind(this.delete),this.hoverDelete=this.delete.hoverForCustomCursor.bind(this.delete),this.stopHoverDelete=this.delete.stopHoverForCustomCursor.bind(this.delete)}setMode(t,e){switch(this.canvas.removeEventListener("mousedown",this.activeMouseDownEvent),this.canvas.removeEventListener("mousemove",this.activeMouseMoveEvent),this.canvas.removeEventListener("mouseleave",this.activeMouseLeaveEvent),e){case"pen":this.canvas.addEventListener("mousedown",this.penStartDraw),this.activeMouseDownEvent=this.penStartDraw;break;case"path":this.canvas.addEventListener("mousedown",this.startPath),this.activeMouseDownEvent=this.startPath;break;case"empty-rect":this.rect.fill=!1,this.canvas.addEventListener("mousedown",this.startRect),this.activeMouseDownEvent=this.startRect;break;case"filled-rect":this.rect.fill=!0,this.canvas.addEventListener("mousedown",this.startRect),this.activeMouseDownEvent=this.startRect;break;case"empty-circle":this.circle.fill=!1,this.canvas.addEventListener("mousedown",this.startCircle),this.activeMouseDownEvent=this.startCircle;break;case"filled-circle":this.circle.fill=!0,this.canvas.addEventListener("mousedown",this.startCircle),this.activeMouseDownEvent=this.startCircle;break;case"move":this.canvas.addEventListener("mousedown",this.startMove),this.canvas.addEventListener("mousemove",this.hoverMove),this.canvas.addEventListener("mouseleave",this.stopHoverMove),this.activeMouseDownEvent=this.startMove,this.activeMouseMoveEvent=this.hoverMove,this.activeMouseLeaveEvent=this.stopHoverMove;break;case"delete":this.canvas.addEventListener("mousedown",this.startDelete),this.canvas.addEventListener("mousemove",this.hoverDelete),this.canvas.addEventListener("mouseleave",this.stopHoverDelete),this.activeMouseDownEvent=this.startDelete,this.activeMouseMoveEvent=this.hoverDelete,this.activeMouseLeaveEvent=this.stopHoverDelete;break}this._selectMode(t)}_selectMode(t){const e=document.getElementsByClassName("tool");for(const s of e)s.classList.remove("selected");t.target.parentElement.classList.contains("tool")?t.target.parentElement.classList.add("selected"):t.target.classList.add("selected")}}function H(o,t){const e=new I(o,t),s=document.getElementsByClassName("tool");for(const i of s)i.addEventListener("click",h=>{e.setMode(h,i.id)})}function U(o){const t=document.getElementById("paint-size-slider"),e=document.getElementById("paint-size-value");t.addEventListener("input",function(){o.lineWidth=parseInt(t.value),e.innerHTML=t.value})}function z(o,t){function e(){r.clearHistory(),r.clearCanvas(o,t)}document.getElementById("clear").addEventListener("click",e)}function B(o,t){document.addEventListener("keydown",e);function e(h){h.ctrlKey&&h.key.toLowerCase()==="z"&&(h.shiftKey?i():s())}function s(){r.undoLastShape(),r.redrawCanvas(o,t)}function i(){r.redoLastShape(),r.redrawCanvas(o,t)}}function A(o,t){E(o),H(o,t),U(o),z(o,t),B(o,t)}const d=document.getElementById("canvas");d.height=window.screen.height;d.width=window.screen.width;d.classList.toggle("cursor-move");d.classList.toggle("cursor-not-allowed");const p=d.getContext("2d");p.lineCap="round";p.lineJoin="round";p.lineWidth=5;A(p,d);document.getElementById("pen").firstElementChild.click();
